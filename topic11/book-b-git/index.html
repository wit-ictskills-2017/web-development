 <!DOCTYPE html>
 <html>
   <head>

     <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1">

     

     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css" type="text/css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/solarized-light.min.css" rel="stylesheet" />

     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/languages/java.min.js"></script>
     <script>hljs.initHighlightingOnLoad();</script>

     

     <style>
       

body 
{
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
}

figcaption
{
  margin-bottom: 20px;
}

.vertical-align
{
  display: flex;
  align-items: center;
}



     </style>

   </head>

  <body>
    

<style>
  

code
{
  font-family: "Monaco";
  font-size: 110%;
}

img
{
  padding:1px;
  border:1px solid black;
}

h1
{
  font-style:italic;
  font-size:130%;
  border-bottom:thin solid black;
}

h2
{
  font-size:110%;
  border-bottom: thin solid black;
}

h3
{
  font-size:100%;
  border-bottom: thin solid black;
}

body
{
  overflow-y: scroll;
}

.pushable > .pusher
{
  padding-bottom: 1.5rem;
}

.ui.segment.pushable
{
  margin: 0;
  padding: 1rem 0;
  overflow: visible;
}



</style>

<div class="ui fixed top pointing inverted menu labmenu">
  <header class="header item">
    <i id="toc" class="sitemap icon"></i>
    <a href="../index.html">
      Git, Github & Bitbucket
    </a>
  </header>
  <div class="right tab-menu menu">
    
    <a class="item" data-tab="Lab-11b Todolist-3">
      Lab-11b Todolist-3
    </a>
    
    <a class="item" data-tab="01">
      01
    </a>
    
    <a class="item" data-tab="02">
      02
    </a>
    
    <a class="item" data-tab="03">
      03
    </a>
    
    <a class="item" data-tab="04">
      04
    </a>
    
    <a class="item" data-tab="05">
      05
    </a>
    
    <a class="item" data-tab="06">
      06
    </a>
    
    <a class="item" data-tab="07">
      07
    </a>
    
    <a class="item" data-tab="08">
      08
    </a>
    
    <a class="item" data-tab="Exercises">
      Exercises
    </a>
    
    <a class="item" href="../../index.html">
      <i class="home icon"></i>
    </a>
  </div>
</div>

<div class="ui segment pushable">
  <div class="ui inverted labeled icon left inline vertical sidebar menu">
    
      
        <a class="item" href="../../topic01/book-a/index.html">
          Lab-1 Editing HTML
        </a>
      
    
      
        <a class="item" href="../../topic01/book-b/index.html">
          Lab-1 HTML Structure
        </a>
      
    
      
        <a class="item" href="../../topic02/book/index.html">
          Lab-2 CSS Intro
        </a>
      
    
      
        <a class="item" href="../../topic03/book-a/index.html">
          Lab-3a Layout
        </a>
      
    
      
        <a class="item" href="../../topic03/book-b/index.html">
          Lab-3b Multicolumn
        </a>
      
    
      
        <a class="item" href="../../topic04/book-a/index.html">
          Lab-4a Navigation 
        </a>
      
    
      
        <a class="item" href="../../topic04/book-b/index.html">
          Lab-4b Case Study
        </a>
      
    
      
        <a class="item" href="../../topic05/book-01-harp/index.html">
          Lab-5a Harp & Surge
        </a>
      
    
      
        <a class="item" href="../../topic05/book-02-templates/index.html">
          Lab-5b Templating
        </a>
      
    
      
        <a class="item" href="../../topic05/book-03-nav/index.html">
          Lab-5c Navigation 
        </a>
      
    
      
        <a class="item" href="../../topic06/book-a/index.html">
          Lab-6a Semantic UI
        </a>
      
    
      
        <a class="item" href="../../topic06/book-b/index.html">
          Lab-6b Semantic UI
        </a>
      
    
      
        <a class="item" href="../../topic07/book-a-setup/index.html">
          Lab-07a Play Setup
        </a>
      
    
      
        <a class="item" href="../../topic07/book-b-playlist-1/index.html">
          Lab-07b Playlist 1
        </a>
      
    
      
        <a class="item" href="../../topic08/book-a-playlist-2/index.html">
          Lab-08a Playlist-2
        </a>
      
    
      
        <a class="item" href="../../topic08/book-b-playlist-3/index.html">
          Lab-08b Playlist-3
        </a>
      
    
      
        <a class="item" href="../../topic09/book-a-todolist/index.html">
          Lab-09b Todolist-1
        </a>
      
    
      
        <a class="item" href="../../topic09/book-b-playlist-4/index.html">
          Lab-09a Playlist-4
        </a>
      
    
      
        <a class="item" href="../../topic10/book-sessions/index.html">
          Lab-10 Todolist-2
        </a>
      
    
      
        <a class="item" href="../../topic11/book-a-sourcetree/index.html">
          Lab-11a Sourcdtree
        </a>
      
    
      
        <a class="active item" href="../../topic11/book-b-git/index.html">
          Lab-11b Todolist-3
        </a>
      
    
      
        <a class="item" href="../../topic12/book-c/index.html">
          Lab-12
        </a>
      
    
  </div>
  <div class="pusher" tabindex="-1">
    <div class="ui basic segment">
      <br>
      
      <div  class="ui tab segment lab" data-tab="Lab-11b Todolist-3">
        <h1>Objectives</h1>
<p>Rebuild Todolist - this time committing to git version control as the app is composed.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="01">
        <h1>todolist-versioned Project</h1>
<p>We should have our project in Sourcetree from the last lab:</p>
<p><img src="img/01.png" alt=""></p>
<p>if we would like to use Intellj Idea - we can &#39;idealize&#39; then app:</p>
<pre><code>play idealize</code></pre>
<p>... and then import into Idea.</p>
<p>For this lab, keep both Idea &amp; Sourcetree open at the same time.</p>
<p>The first thing to notice is the Sourcetree view will have changed slightly: </p>
<p><img src="img/02.png" alt=""></p>
<p>This is because the idealize command as generated some new files in our project:</p>
<ul>
<li>play-template-1.iml</li>
<li>play-template-1.ipr</li>
<li>play-template-1.iws</li>
</ul>
<p>These are configuration file for Idea. We dont need to be concerned with them, and we dont want them committed to our repository as they are not code really. We need to tell git to ignore them.</p>
<p>The built in mechanism for ignoring files in git is to plate the file names, or patterns, in a file called <code>.gitignore</code>. We already have one:</p>
<h2>.gitgnore</h2>
<pre><code>.settings
eclipse
documentation
tmp
.classpath
.project</code></pre>
<p>Edit it now in Idea - and append paths to ignore the Idea files:</p>
<pre><code>...
*.iml
*.ipr
*.iws</code></pre>
<p>Save this file - and review the Sourcetree view again:</p>
<p><img src="img/03.png" alt=""></p>
<p>The change is subtle - git is no longer &#39;tracking&#39; the idea files, but notice that it reporting the one of the files we are tracking - .gitignore - is showing up as having a change.</p>
<p>This change is noted, but not &#39;staged&#39; or &#39;committed&#39; yet. We will do both now</p>
<h2>Staging</h2>
<p>To stage the changes, we just select all the &#39;Unstaged files&#39; check box - which reconfigures the view like this:</p>
<p><img src="img/04.png" alt=""></p>
<h2>Commit</h2>
<p>To commit, press the <code>Cmomit button</code>:</p>
<p><img src="img/05.png" alt=""></p>
<p>We are now invited to enter a message describing the change. Enter this message:</p>
<pre><code>rename project + ignore idea files</code></pre>
<p>and then press the blue Commit button on the bottom right. The Sourcetree will layout like this now:</p>
<p><img src="img/06.png" alt=""></p>
<p>Our change has been committed - and there are no outstanding changes. Notice, however, that the <code>Push</code> button is slightly changed:</p>
<p><img src="img/07.png" alt=""></p>
<p>The superscript &#39;1&#39; indicates that the local repo (the one on your workstation) is 1 ahead (in terms of changes) of the remote repo (the one you created on github.com).</p>
<p>If we press the push button - this dialog appears:</p>
<p><img src="img/08.png" alt=""></p>
<p>Pressing &#39;OK&#39; here will push the channges, such that the local and remote repositories are in sync.</p>
<p>Check the repo on github.com to make sure is has the latest version:</p>
<p><img src="img/09.png" alt=""></p>
<p><img src="img/10.png" alt=""></p>
<p>For each step in this lab we will be proceeding through this workflow:</p>
<ul>
<li>Make some changes to the project</li>
<li>Stage the changes</li>
<li>Commit the changes</li>
<li>Push them to the remote repository</li>
<li>Check to see if they have arrived (sometimes).</li>
</ul>

      </div>
     
      <div  class="ui tab segment lab" data-tab="02">
        <h1>Model</h1>
<p>We can bring in a Todo model now:</p>
<h2>app/models/Todo.java</h2>
<pre><code>package models;

import play.db.jpa.Model;

import javax.persistence.Entity;

@Entity
public class Todo extends Model
{
  public String title;

  public Todo(String title)
  {
    this.title = title;
  }
}</code></pre>
<p>As soon as we save the file, notice the changes have been detected in Sourcetree:</p>
<p><img src="img/11.png" alt=""></p>
<p>We can stage, commit and push whenever we like - usually we stage and commit when we have introduced a significant change. We would only push occasionally.</p>
<p>Lets stage and commit now.</p>
<h2>Stage:</h2>
<p><img src="img/12.png" alt=""></p>
<h2>Commit:</h2>
<p><img src="img/13.png" alt="">
<img src="img/14.png" alt=""></p>
<p>Note the message we entered on the commit - a short description of the change.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="03">
        <h1>Dashboard Controller + View</h1>
<p>Here is a new version of the Dashboard controller + view:</p>
<h2>app/controllers/Dashboard.java</h2>
<pre><code>package controllers;

import models.Todo;
import play.Logger;
import play.mvc.Controller;

import java.util.List;

public class Dashboard extends Controller
{
  public static void index()
  {
    Logger.info(&quot;Rendering Dashboard&quot;);
    List&lt;Todo&gt; todolist = Todo.findAll();
    render(&quot;dashboard.html&quot;, todolist);
  }

  public static void addTodo(String title)
  {
    Todo todo = new Todo(title);
    todo.save();
    Logger.info(&quot;Addint Todo&quot; + title);
    redirect(&quot;/dashboard&quot;);
  }
}</code></pre>
<h2>app/views/dashboard.html</h2>
<pre><code>#{extends &#39;main.html&#39; /}
#{set title:&#39;Dashboard&#39; /}

#{menu id:&quot;dashboard&quot;/}

&lt;section class=&quot;ui raised segment&quot;&gt;
  &lt;header class=&quot;ui header&quot;&gt;
    Todo List
  &lt;/header&gt;
  &lt;table class=&quot;ui fixed table&quot;&gt;
    &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Todo&lt;/th&gt;
      &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;div class=&quot;ui bulleted list&quot;&gt;
    #{list items:todolist, as:&#39;todo&#39;}
    &lt;tr&gt;
      &lt;td&gt; ${todo.title} &lt;/td&gt;
    #{/list}
    &lt;/div&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;

&lt;/section&gt;

&lt;form class=&quot;ui stacked segment form&quot; action=&quot;/dashboard/addtodo&quot; method=&quot;POST&quot;&gt;
  &lt;div class=&quot;field&quot;&gt;
    &lt;label&gt;Title&lt;/label&gt;
    &lt;input placeholder=&quot;Title&quot; type=&quot;text&quot; name=&quot;title&quot;&gt;
  &lt;/div&gt;
  &lt;button class=&quot;ui blue submit button&quot;&gt;Add Todo&lt;/button&gt;
&lt;/form&gt;</code></pre>
<p>Run the app now - and verify that you can add todos.</p>
<p>Stage &amp; Commit these changes - not the message used below:</p>
<p><img src="img/15.png" alt="">
<img src="img/16.png" alt="">
<img src="img/17.png" alt="">
<img src="img/18.png" alt=""></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="04">
        <h1>Delete Todo Support</h1>
<p>Now we can introduce delete support</p>
<h2>conf/routes</h2>
<pre><code>GET     /dashboard/deletetodo/{id}              Dashboard.deleteTodo</code></pre>
<h2>app/controlers/Dashboard.java</h2>
<pre><code>  public static void deleteTodo(Long id)
  {
    Todo todo = Todo.findById(id);
    todo.delete();
    Logger.info(&quot;Deleting &quot; + todo.title);
    redirect(&quot;/dashboard&quot;);
  }</code></pre>
<h2>app/views/dashboard.html</h2>
<p>Revised list to include delete button:</p>
<pre><code>...
      #{list items:todolist, as:&#39;todo&#39;}
      &lt;tr&gt;
        &lt;td&gt; ${todo.title} &lt;/td&gt;
        &lt;td&gt; &lt;a href=&quot;/dashboard/deletetodo/${todo.id} &quot; class=&quot;ui tiny red button&quot;&gt; Delete &lt;/a&gt; &lt;/td&gt;
      #{/list}
..</code></pre>
<p>Stage and commit the above - use the commit message:</p>
<pre><code>introduced delete todo support</code></pre>
<p><img src="img/19.png" alt=""></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="05">
        <h1>UX Modifications</h1>
<p>The app is still branded as &#39;Template 1&#39; - we can change this now:</p>
<h2>app/views/tags/menu.html</h2>
<pre><code>...
  &lt;header class=&quot;ui header item&quot;&gt; &lt;a href=&quot;/&quot;&gt; Todolist V1 &lt;/a&gt;&lt;/header&gt;
...</code></pre>
<h2>app/views/about.html</h2>
<pre><code>...
  &lt;p&gt;
    A simple Todo List Application
  &lt;/p&gt;
...</code></pre>
<h2>app/views/start.html</h2>
<pre><code>...
  &lt;h1 class=&quot;ui header&quot;&gt;
    Welcome to Todolist V1
  &lt;/h1&gt;
  &lt;p&gt;
    Track your todos today!
  &lt;/p&gt;
...</code></pre>
<p>Stage and commit all of the above.</p>
<p>We also might like to <code>Tag</code> this version as being significant - perhaps call it &#39;V1&#39;. This will enable is to get back the this version later more easily.</p>
<p>To do this, first make sure you have &#39;pushed&#39; all updates to github. Then select the most recent change and right clock to select the context menu:</p>
<p><img src="img/20.png" alt=""></p>
<p>Select &#39;Tag&#39; and in the subsequent dialog:</p>
<p><img src="img/21.png" alt=""></p>
<p>.. Enter &#39;V1&#39;. Also, check the &#39;Push Tag&#39; check box in the dialog as shown above. Then press add.</p>
<p>A &#39;V! tag&#39; should now be visible in the commit history:</p>
<p><img src="img/22.png" alt=""></p>
<p>If you visit the repo on github - then this version will be marked as a <code>Release</code>:</p>
<p><img src="img/23.png" alt="">
<img src="img/24.png" alt=""></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="06">
        <h1>Member Model</h1>
<p>Introducing accounts we need a new model:</p>
<h2>app/models/Member.java</h2>
<pre><code>package models;

import play.db.jpa.Model;

import javax.persistence.CascadeType;
import javax.persistence.Entity;
import javax.persistence.OneToMany;
import java.util.ArrayList;
import java.util.List;

@Entity
public class Member extends Model
{
  public String firstname;
  public String lastname;
  public String email;
  public String password;

  @OneToMany(cascade = CascadeType.ALL)
  public List&lt;Todo&gt; todolist = new ArrayList&lt;Todo&gt;();

  public Member(String firstname, String lastname, String email, String password)
  {
    this.firstname = firstname;
    this.lastname = lastname;
    this.email = email;
    this.password = password;
  }

  public static Member findByEmail(String email)
  {
    return find(&quot;email&quot;, email).first();
  }

  public boolean checkPassword(String password)
  {
    return this.password.equals(password);
  }
}</code></pre>
<p>We can also bring in a data file to preload the model:</p>
<h2>conf/data.yml</h2>
<pre><code>Todo(t1):
  title: Make tea

Todo(t2):
  title: Go for snooze

Todo(t3):
  title: Make more tea

Member(m1):
  firstname: homer
  lastname: simpson
  email: homer@simpson.com
  password: secret
  todolist:
  - t1
  - t2

Member(m2):
  firstname: marge
  lastname: simpson
  email: marge@simpson.com
  password: secret
  todolist:
  - t3</code></pre>
<p>We then need a new class to load this model:</p>
<h2>app/Bootstrap.java</h2>
<pre><code>import java.util.List;

import play.*;
import play.jobs.*;
import play.test.*;

import models.*;

@OnApplicationStart
public class Bootstrap extends Job
{
  public void doJob()
  {
    if (Member.count() == 0)
    {
      Fixtures.loadModels(&quot;data.yml&quot;);
    }
  }
}</code></pre>
<p>Stage and commit these changes now with a suitable message.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="07">
        <h1>Accounts Views</h1>
<p>We need a number of new views to support login/signup:</p>
<h2>app/views/tags/welcomemenu.html</h2>
<pre><code>&lt;nav class=&quot;ui menu&quot;&gt;
  &lt;header class=&quot;ui header item&quot;&gt; &lt;a href=&quot;#&quot;&gt; Todo List &lt;/a&gt;&lt;/header&gt;
  &lt;div class=&quot;right menu&quot;&gt;
    &lt;a id=&quot;signup&quot; class=&quot;item&quot; href=&quot;/signup&quot;&gt; Signup  &lt;/a&gt;
    &lt;a id=&quot;login&quot; class=&quot;item&quot; href=&quot;/login&quot;&gt;  Login   &lt;/a&gt;
  &lt;/div&gt;
&lt;/nav&gt;

&lt;script&gt;
  $(&quot;#${_id}&quot;).addClass(&quot;active item&quot;);
&lt;/script&gt;</code></pre>
<h2>app/views/login.html</h2>
<pre><code>#{extends &#39;main.html&#39; /}
#{set title:&#39;login&#39; /}
#{welcomemenu id:&quot;login&quot;/}

&lt;div class=&quot;ui two column middle aligned grid basic segment&quot;&gt;
  &lt;div class=&quot;column&quot;&gt;
    &lt;form class=&quot;ui stacked segment form&quot; action=&quot;/authenticate&quot; method=&quot;POST&quot;&gt;
      &lt;h3 class=&quot;ui header&quot;&gt;Log-in&lt;/h3&gt;
      &lt;div class=&quot;field&quot;&gt;
        &lt;label&gt;Email&lt;/label&gt; &lt;input placeholder=&quot;Email&quot; name=&quot;email&quot;&gt;
      &lt;/div&gt;
      &lt;div class=&quot;field&quot;&gt;
        &lt;label&gt;Password&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;
      &lt;/div&gt;
      &lt;button class=&quot;ui blue submit button&quot;&gt;Login&lt;/button&gt;
    &lt;/form&gt;
  &lt;/div&gt;
  &lt;div class=&quot;column&quot;&gt;
    &lt;img class=&quot;ui image&quot; src=&quot;/public/images/todo-2.jpg&quot;&gt;
  &lt;/div&gt;</code></pre>
<h2>app/views/signup.html</h2>
<pre><code>#{extends &#39;main.html&#39; /}
#{set title:&#39;Signup&#39; /}
#{welcomemenu id:&quot;signup&quot;/}

&lt;div class=&quot;ui two column grid basic middle aligned segment&quot;&gt;
  &lt;div class=&quot;column&quot;&gt;
    &lt;form class=&quot;ui stacked segment form&quot; action=&quot;/register&quot; method=&quot;POST&quot;&gt;
      &lt;h3 class=&quot;ui header&quot;&gt;Register&lt;/h3&gt;
      &lt;div class=&quot;two fields&quot;&gt;
        &lt;div class=&quot;field&quot;&gt;
          &lt;label&gt;First Name&lt;/label&gt;
          &lt;input placeholder=&quot;First Name&quot; type=&quot;text&quot; name=&quot;firstname&quot;&gt;
        &lt;/div&gt;
        &lt;div class=&quot;field&quot;&gt;
          &lt;label&gt;Last Name&lt;/label&gt;
          &lt;input placeholder=&quot;Last Name&quot; type=&quot;text&quot; name=&quot;lastname&quot;&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;field&quot;&gt;
        &lt;label&gt;Email&lt;/label&gt;
        &lt;input placeholder=&quot;Email&quot; type=&quot;text&quot; name=&quot;email&quot;&gt;
      &lt;/div&gt;
      &lt;div class=&quot;field&quot;&gt;
        &lt;label&gt;Password&lt;/label&gt;
        &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;
      &lt;/div&gt;
      &lt;button class=&quot;ui blue submit button&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
  &lt;/div&gt;
  &lt;div class=&quot;column&quot;&gt;
    &lt;img class=&quot;ui image&quot; src=&quot;/public/images/todo-1.png&quot;&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>In addition, the start view needs to be changed to include the welcomemenu instead of the main menu:</p>
<h2>app/views/start.html</h2>
<pre><code>...
#{welcomemenu id:&quot;start&quot;/}
...</code></pre>
<p>Finally, the dashboard view will need a different delete button:</p>
<h2>app/views/dashboard.html</h2>
<pre><code>...
      &lt;td&gt; &lt;a href=&quot;/dashboard/${member.id}/deletetodo/${todo.id} &quot; class=&quot;ui tiny red button&quot;&gt; Delete &lt;/a&gt; &lt;/td&gt;
...</code></pre>
<p>(This  replaces the existing delete button).</p>
<p>Stage and commit all of these changes now, with a suitable message.</p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="08">
        <h1>Accounts Routes + Controllers</h1>
<p>To finish the upgrade to accounts - we need this revised routes file (replace the existing one):</p>
<h2>conf/routes</h2>
<pre><code># Routes
# This file defines all application routes (Higher priority routes first)
# ~

GET     /                                       Start.index

# Accounts
GET    /signup                                  Accounts.signup
GET    /login                                   Accounts.login
POST   /register                                Accounts.register
POST   /authenticate                            Accounts.authenticate
GET    /logout                                  Accounts.logout

# Home page
GET     /dashboard                              Dashboard.index
GET     /dashboard/{id}/deletetodo/{todoid}     Dashboard.deleteTodo
GET     /about                                  About.index

# Ignore favicon requests
GET     /favicon.ico                            404

# Map static resources from the /app/public folder to the /public path
GET     /public/                                staticDir:public

# Catch all
*       /{controller}/{action}                  {controller}.{action}</code></pre>
<p>This new controller:</p>
<h2>app/controllers/Accounts.java</h2>
<pre><code>package controllers;

import models.Member;
import play.Logger;
import play.mvc.Controller;

public class Accounts extends Controller
{
  public static void signup()
  {
    render(&quot;signup.html&quot;);
  }

  public static void login()
  {
    render(&quot;login.html&quot;);
  }

  public static void register(String firstname, String lastname, String email, String password)
  {
    Logger.info(&quot;Registering new user &quot; + email);
    Member member = new Member(firstname, lastname, email, password);
    member.save();
    redirect(&quot;/&quot;);
  }

  public static void authenticate(String email, String password)
  {
    Logger.info(&quot;Attempting to authenticate with &quot; + email + &quot;:&quot; + password);

    Member member = Member.findByEmail(email);
    if ((member != null) &amp;&amp; (member.checkPassword(password) == true)) {
      Logger.info(&quot;Authentication successful&quot;);
      session.put(&quot;logged_in_Memberid&quot;, member.id);
      redirect (&quot;/dashboard&quot;);
    } else {
      Logger.info(&quot;Authentication failed&quot;);
      redirect(&quot;/login&quot;);
    }
  }

  public static void logout()
  {
    session.clear();
    redirect (&quot;/&quot;);
  }

  public static Member getLoggedInMember()
  {
    Member member = null;
    if (session.contains(&quot;logged_in_Memberid&quot;)) {
      String memberId = session.get(&quot;logged_in_Memberid&quot;);
      member = Member.findById(Long.parseLong(memberId));
    } else {
      login();
    }
    return member;
  }
}</code></pre>
<p>This is a new version of Dashboard:</p>
<h2>app/controllers/Dashboard.java</h2>
<pre><code>package controllers;

import models.Member;
import models.Todo;
import play.Logger;
import play.mvc.Controller;

import java.util.List;

public class Dashboard extends Controller
{
  public static void index()
  {
    Logger.info(&quot;Rendering Dashboard&quot;);
    Member member = Accounts.getLoggedInMember();
    List&lt;Todo&gt; todolist = member.todolist;
    render(&quot;dashboard.html&quot;, member, todolist);
  }

  public static void addTodo(String title)
  {
    Member member = Accounts.getLoggedInMember();
    Todo todo = new Todo(title);
    member.todolist.add(todo);
    member.save();
    Logger.info(&quot;Adding Todo&quot; + title);
    redirect(&quot;/dashboard&quot;);
  }

  public static void deleteTodo(Long id, Long todoid)
  {
    Member member = Member.findById(id);
    Todo todo = Todo.findById(todoid);
    member.todolist.remove(todo);
    member.save();
    todo.delete();
    Logger.info(&quot;Deleting &quot; + todo.title);
    redirect(&quot;/dashboard&quot;);
  }
}</code></pre>
<p>See if the app runs now as expected, and that the todo items are kept separeaty by user. Also verify that we can delete  todos.</p>
<p>Stage and commit all changes in this step - and tag this version &#39;V2&#39;.</p>
<p><img src="img/25.png" alt=""></p>

      </div>
     
      <div  class="ui tab segment lab" data-tab="Exercises">
        <h1>Exercises</h1>
<p>Your repo should be structured something like this one now:</p>
<ul>
<li><a href="https://github.com/edeleastar/todolist-versioned">https://github.com/edeleastar/todolist-versioned</a></li>
</ul>
<h2>Exercise 1: Running an Earlier Version</h2>
<p>In Sourcetree, select the <code>V1</code> tagged commit, right click and select <code>Reset master to this commit</code> as shown here:</p>
<p><img src="img/26.png" alt=""></p>
<p>In the subsequent dialog, select &#39;Hard - diacard all working copy changes&#39;</p>
<p><img src="img/27.png" alt=""></p>
<p>You will get a warning - which you can accept:</p>
<p><img src="img/28.png" alt=""></p>
<p>The project folder will now contain the V1 project. </p>
<p><img src="img/29.png" alt=""></p>
<p>You can run this version now - and make sure it is that version (no member support)</p>
<h2>Exercise 2: Get back to the latest version</h2>
<p>See if you can get back to V2 - it is more or less the same procedure as getting to V1, but in reverse.</p>
<h2>Exercise 3: Clone the repo</h2>
<p>Figure out how to clone the repo into another folder on your workstation. Once cloned, you can drag/drop the new copy int Sourtree alongside the original.</p>
<p>Idealize the new copy and import into Idea, and run it. (Continue to use eclipse if you like).</p>
<p>Make some changes in the new copy - for instance the signup and login files have links to images which do not exist. Find suitable images - and put them into <code>/public/images</code>. Make sure the names match what the forms expect.</p>
<p>Stage, commit and push these changes from the new copy.</p>
<p>Back in the original, pull the changes into this version. Make sure the changes have come over.</p>

      </div>
     
    </div>
  </div>
</div>
  <div class="ui bottom fixed borderless right menu">
    <div class="ui right tiny menu">
      <div class="ui mini message segment">
        Eamonn de Leastar (edeleastar@wit.ie).
        <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/"
            target="_blank">Creative Commons License
        </a>
      </div>
    </div>
  </div>

<script>
  $(document).on('keydown', function (e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

</script>

    <footer>

    </footer>
    <script>
      $(document).ready(function () {
  $('img').addClass('ui image');
  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function (i) {
    if (($images[i].alt).length > 0) {
      const divImg = $(document.createElement('div')).addClass('ui basic segment');
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass('ui blue ribbon label');
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.embed').embed();

  $('.ui.menu .item')
      .tab({
        history: true,
        historyType: 'hash',
      });

  $('.popup').popup();

  $('.ui.sidebar')
      .sidebar({ context: $('.pushable') })
      .sidebar('setting', 'transition', 'slide out')
      .sidebar('attach events', '#toc');
});

    </script>
  </body>

 </html>